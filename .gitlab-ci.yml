variables:
  UV_CACHE_DIR: "$CI_PROJECT_DIR/.cache/uv"

test_unit:
  image: python:3.11-slim
  before_script:
    - pip install uv
  script:
    - uv venv .venv
    - source .venv/bin/activate
    - uv pip install -r requirements.txt
    # Run all tests (ignoring real DB integration tests which fail in CI)
    - pytest --ignore=tests/test_real_db.py
  cache:
    key: "uv-v1"
    paths:
      - .cache/uv
  only:
    - main
    - dev
